calc-prorrat-s3-to-db:
  handler: index.calcProrratS3ToDb
  iamRoleStatements:
    - Effect: Allow
      Action:
        - s3:*
      Resource:
        - arn:aws:s3:::${self:provider.environment.BUCKET}
    - Effect: Allow
      Action:
        - dynamodb:*
      Resource: 
        - "arn:aws:dynamodb:${opt:region, self:provider.region}:*:table/${self:provider.environment.CUSTOMERS_TABLE}"
  events:
    - s3:
        bucket: ${self:provider.environment.BUCKET}
        event: s3:ObjectCreated:*
        rules:
          - suffix: .csv

get-customer-info:
  handler: index.getCustomerInfo
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:*
      Resource: 
        - "arn:aws:dynamodb:${opt:region, self:provider.region}:*:table/${self:provider.environment.CUSTOMERS_TABLE}"
  events:
    - http:
        path: /{customerId}
        method: get
        integration: lambda-proxy
        cors:
          origin: '*'
          headers:
            - Content-Type
            - X-Amz-Date
            - Authorization
            - X-Api-Key
            - X-Amz-Security-Token
            - X-Amz-User-Agent
            - Access-Controll-Allow-Origin
          allowCredentials: false